# 《代码大全2》第二十五章 “代码调整策略” 读书笔记

本章讨论程序性能够调整-效率与程序的可读性和可维护性取舍的策略
## 25.1 性能概述

### 质量特性和性能
相对于代码质量,用户更关心的是程序的外在特性。对用户来说,程序员按时交付软件,提供一个清爽的用户界面,避免系统死机常常比程序的性能更为重要。
### 性能和代码调整
#### 程序需求
在花费时间处理一个性能问题之前,请想清楚你的确是在解决一个确实需要解决的问题。

#### 程序的设计
在架构上考虑程序的的速度与资源占用目标

#### 类和子程序的设计
#### 程序同操作系统的交互
#### 代码编译
优秀的编译器能将清晰的高级语言代码转换为经过优化后的机器码。如果选
择了合适的编译器,你可能无须再考虑如何进一步优化程序的运行速度,直接就
能获得满意的程序性能了。（往往容易被人忽视）
#### 硬件
#### 代码调整

``` 感想
以上6个层次的调整都会直接影响程序的性能，而且是累乘关系，
出现性能问题，往往第一想到的是代码调整，可以多考虑一下其他层次，
有一次切SDK爆出一堆性能问题，结果只是打SDK没关优化
个人觉得性能分析考虑用接口测试覆盖更合适，从本节可以看出，影响程序性能的因素非常多，
通过接口测试可以屏蔽部分干扰，让性能测试的结果更准确，更好地帮助开发者发现和修改问题
``` 
## 25.2 代码调整简介
不是改进性能的最为有效的方法，不是最方便的改善性能的方法，不是成本最低的方法，但是可以给开发者带来成就感
法则：
* 小部分子程序占用了程序大部分的执行时间，
* 当某个程序绝大多数的代码都是由诸如 Python这样的解释型语言编写时,程序员同样应该把其中最关键的部分用C这样的编译型语言重写
* 程序员们首先应该实现程序应该具备的所有功能,然后再使程序臻于完美
* 在高级语言中,减少代码的行数与运行速度没有直接关系
* 程序员应当使用高质量的设计,把程序编写正确。使之模块化并易于修改,让后期的维护工作变得很容易。在程序经完成并正确之后,再去检查系统的性能。如果程序运行迟钝,那么再设法让它更快更小除非你对需要完成的工作
* 每一种编译器都拥有和别的编译器所不同的优势和弱点
* 与那些充满技巧的代码相比,编译器的优化功能对那些平铺直叙的代码更见效
## 25.3 蜜糖和哥斯拉
这一节介绍加快程序运行速度和优化体积的方法
* 输入/输出操作 （访问内存比访问文件快上1000倍）
* 引发操作系统交换内存页面的运算会比在内存同一页中进行的运算慢许多
* 调用系统子程序的代价常常是十分可观的
* 解释型语言（作者给的参考数据Python速度比C++慢100倍）
* 程序性能的终极麻烦就是代码中的错误（没有去掉调试代码、忘了释放内存、数据库表设计失误、轮询并不存在的设备直至超时）

## 25.4 性能测量
经验对性能优化也没有太大的帮助，需要通过测量来证明，有的时候看起来低效的代码经过编译器优化可以一样高效且更易懂

## 25.5 反复调整
大部分优化方法单独看起来都收效甚微,但累计起来,效果是惊人的
## 25.6 代码调整方法总结
1. 用设计良好的代码来开发软件,从而使程序易于理解和修改。
2. 如果程序性能很差。
      a. 保存代码的可运行版本,这样你才能回到“最近的已知正常状态”;  
      b. 对系统进行分析测量,找出热点;  
      c. 判断性能拙劣是否源于设计、数据类型或算法上的缺陷,确定是否应该  
      做代码调整,如果不是,请跳回到第一步;  
      d. 对步骤c中所确定的瓶颈代码进行调整;  
      e. 每次调整后都对性能提升进行测量;  
      f. 如果调整没有改进代码的性能,就恢复到步骤a保存的代码(通常而言,超过一半的调整尝试都只能稍微改善性能甚至造成性能恶化)
3. 重复步骤2

``` 读后感
读后感：
      通过这一章的阅读让我意识到了平时非常无感的编译器优化的作用与重要性，
      编译器优化能够带来40%以上的效率提升，能够帮助我们实现代码可读性与性能的双丰收
      同时作者给出了几个有意思的结论：
      1. 经验对性能优化也没有太大的帮助
      2. 代码调整既不是最为有效、也不是最方便，还不是成本最低的提高效率的方法，只是开发者比较青睐
      3. 极少部分代码运行占用了程序大部分时间，找出并优化这一下部分往往能够解决实际的问题
      4. 在不是对效率要求特别敏感的时候，先写好程序，再考虑运行效率即可
```  

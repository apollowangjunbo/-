# 《代码大全2》第十三章 “不常见的数据类型” 读书笔记

## 13.1 结构体
1. “结构体”这一术语指的是使用其他类型组建的数据。
2. 类相对于结构体的优势：除了公用数据成员外,还能利用类所提供的私密性和功能性。
3. 使用结构体的理由：
      * 用结构体来明确数据之间的关系
      * 用结构体简化对数据块的操作（如交换两个结构体对象的数据）
      * 用结构体来简化参数列表
      * 用结构体来减少维护（参数列表传结构体，添加或删除参数的时候无需调整所有的参数列表）
``` 感想
感想：
      在C++中结构体也可以拥有自己的成员函数，与类的区别在于默认情况下结构体的所有方法与成员都是public的，继承时也是默认public继承
```  
## 13.2 指针
每一个指针都包含两个部分:内存中的某处位置,以及如何解
释该位置中的内容

正确使用指针的双向策略:  
1. 避免造成指针错误（预防性措施）  
2. 尽快地检测出指针错误来 

### 使用指针的一般技巧
* 把指针操作限制在子程序或者类里面（封装复杂度）
* 同时声明和定义指针（避免被错误的在定义前使用）
* 在与指针分配相同的作用域中删除指针（函数里new却指望外部释放）
* 在使用指针之前检查指针
* 先检查指针所引用的变量再使用它
* 用狗牌字段来检测损毁的内存
* 增加明显冗余
* 用额外的指针变量来提高代码清晰（声明名称清晰地临时变量，降低理解成本）
* 简化复杂的指针表达式
* 按照正确的顺序删除链表中的指针
* 分配一片保留的内存后备区域
* 粉碎垃圾数据
* 在删除或者释放指针之后把它们设为空值
* 在删除变量之前检查非法指针
* 跟踪指针分配情况
* 编写覆盖子程序,集中实现避免指针问题的策略
* 采用非指针的技术

### C++ 指针与引用
* 引用必须总是引用一个对象,而指针则可以指向空值,还有,引用所指向的对象在该引用初始化之后不能改变
* 把指针用于“按引用传递”参数,把cons引用用于“按值传递”参数
* 使用auto_ptr（已经被 unique_ptr 取代）

``` 感想
感想：
之前见到的情况：
      1.主流程调用的子程序new了指针A，主程序没有记得释放指针A。
      2.主流程调用的子程序new了指针A，主程序记得释放指针A，但是在释放前指针的被另一个子程序拷贝给了指针B，导致调用指针B的时候已经被释放了，崩溃。
      3.主流程调用的子程序new了指针A，另一个子程序对指针A所指的对象进行加工存进了指针B，并对指针A进行了释放，主程序不知道A已经被释放，再次delete指针A，崩溃。
      4.满世界传智能指针，导致效率问题。
好的习惯：
      初始化的时候不想new的时候初始化为nullptr，释放之后顺手给指针赋值nullptr，使用之前就可以直接判断指针是否等于nullptr
```  

## 13.3 全局数据

全局数据违背信息隐藏和模块化的原则，增加理解和维护成本，不推荐使用，使用更好的方式取代。

全局数据带来的问题：
* 无意间修改了全局数据
* 与全局数据有关的奇异的和令人激动的别名问题（全局变量被当作参数传入时，会有两个变量实际上是一个变量）
* 与全局数据有关的代码重入(re-entrant)问题（多个线程、多个程序访问同一个全局变量）
* 全局数据阻碍代码重用（依赖全局环境了，拆不出来）
* 与全局数据有关的非确定的初始化顺序事宜
* 全局数据破坏了模块化和智力上的可管理性

### 使用全局数据的理由
* 保存全局数值（概念上用于整个程序的数据）
* 模拟具名常量
* 模拟枚举类型
* 简化对极其常用的数据的使用（避免出现在每一处参数列表里面）
* 消除流浪数据（一个数据经过层层传递才被使用）
  
### 只有万不得已时才使用全局数据
替代方案:
1. 首先把每一个变量设置为局部的,仅当需要时才把变量设置为全局的(局部变量->成员变量->全局变量，谨慎的逐步放开)
2. 区分全局变量和类变量（模块化）
3. 使用访问器子程序，你用全局数据能做的任何事情,都可以用访问器子程序做得更好，优点：  
   * 获得了对数据的集中控制
   * 可以确保对变量的所有引用都得到了保护
   * 可以自动获得信息隐藏的普遍益处
   * 访问器子程序可以很容易地转变为抽象数据类型
### 如何使用访问器子程序
把数据隐藏到类里面。用static关键字或者它的等价物来声明该数据以确保只存在该数据的单一实例。写出让你可以查看并且修改该数据的子程序来。要求类外部的代码使用该访问器子程序来访问该数据,而不是直接操作它。
* 要求所有的代码通过访问器子程序来存取数据
* 不要把你所有的全局数据都扔在一处（丧失了信息隐藏和抽象数据类型所带来的好处）
* 用锁定来控制对全局变量的访问（开发阶段发现多处同时使用的防范措施）
* 在你的访问器子程序里构建一个抽象层（获取下一个全局id）
* 使得对一项数据的所有访问都发生在同一个抽象层上

### 如何降低使用全局数据的风险
* 创建一种命名规则来突出全局变量
* 为全部的全局变量创建一份注释良好的清单
* 不要用全局变量来存放中间结果
* 不要把所有的数据都放在一个大对象中并到处传递，以说明你没有使用全局变量

